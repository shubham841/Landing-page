const MULTIPLE_PIXELS_DELAY=200;const INIT_PIXEL_EVENT_NAME='init';const TRK_SERVER="trk.clinch.co";const CLINCH_CLICK_ID_PARAM_NAME='clinchClickId';const pixelTypes={iframe:'iframe',img:'image',};Array.prototype.includes=Array.prototype.includes||function(a){return this.indexOf(a)>-1};!function(){function EverCookie(){const _cookie_values_={};const cookieMethodsOrdered=['simpleCookie','localStore','sessionStorage','globalStorage','png','openDatabase'];if(cookieMethodsOrdered.includes('png')){document.createElement("canvas").getContext&&(typeof _cookie_values_.pngData==="undefined"||_cookie_values_.pngData==="")}const cookieMethods={simpleCookie:{isAvailable:function(){return true},get:function(a){try{const pairs=document.cookie.split(';');for(let i=0;i<pairs.length;i++){const pair=pairs[i].split('=');if(a===(pair[0]+'').trim()){_cookie_values_.simpleCookieData=unescape(pair[1])}else{_cookie_values_.simpleCookieData=""}}return Promise.resolve(_cookie_values_.simpleCookieData)}catch(e){return Promise.resolve()}},set:function(a,b){try{const d=new Date();d.setTime(d.getTime()+(2*365*24*60*60*1000));const expires='expires='+d.toUTCString();document.cookie=a+'='+b+';'+expires+';path=/'}catch(e){}}},localStore:{isAvailable:function(){try{if(window.localStorage&&window.localStorage.getItem&&typeof window.localStorage.getItem==="function"){return true}return false}catch(e){}return false},get:function(a){try{_cookie_values_.localStorageData=window.localStorage.getItem(a);return Promise.resolve(_cookie_values_.localStorageData)}catch(e){return Promise.resolve()}},set:function(a,b){try{window.localStorage.setItem(a,b)}catch(e){}}},sessionStorage:{isAvailable:function(){try{if(window.sessionStorage&&window.sessionStorage.getItem&&typeof window.sessionStorage.getItem==="function"){return true}return false}catch(e){}return false},get:function(a){try{_cookie_values_.sessionsStorageData=window.sessionStorage.getItem(a);return Promise.resolve(_cookie_values_.sessionsStorageData)}catch(e){return Promise.resolve()}},set:function(a,b){try{window.sessionStorage&&window.sessionStorage.setItem(a,b)}catch(e){}}},globalStorage:{isAvailable:function(){try{if(window.globalStorage){return true}return false}catch(e){}return false},get:function(a){const host=getHost();try{_cookie_values_.globalStorageData=window.globalStorage[host][a];return Promise.resolve(_cookie_values_.globalStorageData)}catch(e){return Promise.resolve()}},set:function(a,b){const host=getHost();try{window.globalStorage[host][a]=b}catch(e){}}},png:{isAvailable:function(){return false;try{const _canvas_=document.createElement("canvas");if(typeof _canvas_.getContext==="function"){return true}return false}catch(e){}return false},get:function(a){const canvas=document.createElement("canvas");let img,ctx,origvalue;canvas.style.visibility="hidden";canvas.style.position="absolute";canvas.width=200;canvas.height=1;if(canvas&&canvas.getContext){img=new Image();img.style.visibility="hidden";img.style.position="absolute";_cookie_values_.pngData=undefined;ctx=canvas.getContext("2d");origvalue=getFromStr(g.pngCookieName,document.cookie);document.cookie=g.pngCookieName+"=; expires=Mon, 20 Sep 2010 00:00:00 UTC; path=/; domain="+g.domain;img.onload=function(){document.cookie=g.pngCookieName+"="+origvalue+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/; domain="+g.domain;_cookie_values_.pngData="";ctx.drawImage(img,0,0);const imgd=ctx.getImageData(0,0,200,1),pix=imgd.data;let i,n;for(i=0,n=pix.length;i<n;i+=4){if(pix[i]===0){break}_cookie_values_.pngData+=String.fromCharCode(pix[i]);if(pix[i+1]===0){break}_cookie_values_.pngData+=String.fromCharCode(pix[i+1]);if(pix[i+2]===0){break}_cookie_values_.pngData+=String.fromCharCode(pix[i+2])}return Promise.resolve(_cookie_values_.pngData)};img.onerror=function(){_cookie_values_.pngData="";return Promise.resolve()};img.src=g.baseurl+g.phpuri+g.pngPath+"?name="+a+"&cookie="+g.pngCookieName;img.crossOrigin='Anonymous'}},set:function(a,b){const canvas=document.createElement("canvas");let img;canvas.style.visibility="hidden";canvas.style.position="absolute";canvas.width=200;canvas.height=1;if(canvas&&canvas.getContext){img=new Image();img.style.visibility="hidden";img.style.position="absolute";document.cookie=g.pngCookieName+"="+b+"; path=/; domain="+g.domain;img.src=g.baseurl+g.phpuri+g.pngPath+"?name="+a+"&cookie="+g.pngCookieName;img.crossOrigin='Anonymous'}}},openDatabase:{isAvailable:function(){try{if(typeof window.openDatabase==='function'){return true}return false}catch(e){}return false},get:function(f){try{const database=window.openDatabase("sqlite_db_forall","","dojrdi",1024*1024);database.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS cache("+"id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, "+"name TEXT NOT NULL, "+"value TEXT NOT NULL, "+"UNIQUE (name)"+")",[],function(c,d){c.executeSql("SELECT value FROM cache WHERE name=?",[f],function(a,b){if(b.rows.length>=1){_cookie_values_.openDatabaseData=b.rows.item(0).value}else{_cookie_values_.openDatabaseData=""}return Promise.resolve(_cookie_values_.openDatabaseData)},function(a,b){_cookie_values_.openDatabaseData="";return Promise.resolve(_cookie_values_.openDatabaseData)})},function(a,b){_cookie_values_.openDatabaseData="";return Promise.resolve(_cookie_values_.openDatabaseData)})})}catch(e){}},set:function(d,f){try{const database=window.openDatabase("sqlite_db_forall","","dojrdi",1024*1024);database.transaction(function(c){c.executeSql("CREATE TABLE IF NOT EXISTS cache("+"id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, "+"name TEXT NOT NULL, "+"value TEXT NOT NULL, "+"UNIQUE (name)"+")",[],function(a,b){},function(a,b){});c.executeSql("INSERT OR REPLACE INTO cache(name, value) "+"VALUES(?, ?)",[d,f],function(a,b){},function(a,b){})})}catch(e){}}}};this.initializeCookieMethods=function(){const indecesToRemove=[];for(let m in cookieMethodsOrdered){if(cookieMethods.hasOwnProperty(cookieMethodsOrdered[m])){if(!cookieMethods[cookieMethodsOrdered[m]].isAvailable()){indecesToRemove.push(m)}}}if(indecesToRemove.length){for(let i=indecesToRemove.length-1;i>=0;i--){cookieMethodsOrdered.splice(indecesToRemove[i],1)}}};this.setCookie=function(a,b){for(let m in cookieMethodsOrdered){if(cookieMethods.hasOwnProperty(cookieMethodsOrdered[m])){cookieMethods[cookieMethodsOrdered[m]].set(a,b)}}};this.getCookie=function(b){const getCookiePromises=[];for(let m in cookieMethodsOrdered){if(cookieMethods.hasOwnProperty(cookieMethodsOrdered[m])){getCookiePromises.push(cookieMethods[cookieMethodsOrdered[m]].get(b))}}return Promise.all(getCookiePromises).then(function(a){for(let i=0;i<a.length;i++){if(a[i]){return Promise.resolve(a[i])}}return Promise.resolve('')})}};const cookieManager=new EverCookie();function getHost(){return window.location.host.replace(/:\d+/,'')};const _cssText="#_ec_rgb_link:visited{display:none;color:#FF0000;width:0;height:0}";let style;try{created_style=1;style=document.createElement("style");if(style.styleSheet){style.styleSheet.innerHTML=_cssText}else if(style.innerHTML){style.innerHTML=_cssText}else{style.appendChild(document.createTextNode(_cssText))}}catch(e){created_style=0}var g={history:true,java:true,tests:10,silverlight:true,lso:true,domain:'.'+window.location.host.replace(/:\d+/,''),baseurl:'',asseturi:'/assets',phpuri:'/php',authPath:false,swfFileName:'/withbestwishes.swf',xapFileName:'/withbestwishes.xap',jnlpFileName:'/withbestwishes.jnlp',pngCookieName:'withbestwishes_png',pngPath:'/withbestwishes_png.php',etagCookieName:'withbestwishes_etag',etagPath:'/withbestwishes_etag.php',cacheCookieName:'withbestwishes_cache',cachePath:'/withbestwishes_cache.php',hsts:false,hsts_domains:[],db:true,idb:true};function getFromStr(a,b){if(typeof b!=="string"){return}const nameEQ=a+"=",ca=b.split(/[;&]/);let i,c;for(i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)===" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)===0){return c.substring(nameEQ.length,c.length)}}};cookieManager.initializeCookieMethods();function getQuerystringParams(){const params={};const parser=document.createElement('a');parser.href=window.location.href;const query=parser.search.substring(1);const vars=query.split('&');for(let i=0;i<vars.length;i++){const pair=vars[i].split('=');params[pair[0]]=decodeURIComponent(pair[1])}return params};var h,c1pc;const pixels={};const ver="3.4";const executeJobQueue=[];let timeoutHandler;const EVENT_DELAY=3000;const DELAYED_PAGE_VIEW='DelayedPageView';const clinchPixelTypeDic={'ViewContent':"details",'ViewCategory':"category",'Search':"search",'AddToWishlist':"addToWishlist",'InitiateCheckout':"checkout",'AddPaymentInfo':"checkout",'Lead':"registration",'CompleteRegistration':"registration",'AddToCart':"addToCart",'RemFromCart':"RemFromCart",'CartPage':"addToCart",'Purchase':"purchase",'PageView':"pageView",[DELAYED_PAGE_VIEW]:"pageView",};const fbToClinchParameterDic={'search_string':"term",'content_category':"category",'price':'price','currency':"currency",'value':"amount",'checkin_date':"checkin",'checkout_date':"checkout",'city':"city",'departing_departure_date':"depart",'returning_departure_date':"return",'origin_airport':"from",'destination_airport':"to",'travel_start':"depart",'travel_end':"return",'postal_code':'postal_code','make':'make','model':'model','year':'year','state_of_vehicle':'state_of_vehicle','exterior_color':'exterior_color','transmission':'transmission','body_syle':'body_style','fuel_type':'fuel_type','drivetrain':'drivetrain','preferred_price_range':'preferred_price_range',};function initPixel(a,b){if(!a){return console.error("CLINCH: DSID not valid on init")}if(pixels[a]){return console.warn('Datasource '+a+' is already initialized')}if(!b.cid){return console.error("CLINCH: CID not valid on init")}else{console.log("CLINCH: clq() init ver "+ver)}pixels[a]={...b};timeoutHandler=setTimeout(clqOperation.bind(this,'trackSingle',a,DELAYED_PAGE_VIEW),EVENT_DELAY)};function clqOperation(){try{let operation,pixelTypeName,pixelParams;let type="";let stype="";let clinchPixelIds="";let clinchCustomParams="";let content_ids=[];let paramsObjStr;operation=arguments[0];const pixelsToSend=[];let shouldFireSinglePixel=false;shouldFireSinglePixel=['trackSingle','trackSingleCustom'].includes(operation);if(shouldFireSinglePixel){const dsid=arguments[1];pixelTypeName=arguments[2];pixelParams=arguments[3];const pixelData=pixels[dsid];if(pixelData){pixelsToSend.push({dsid,...pixelData})}else{console.log('Failed getting initialized datasource with ID '+dsid);pullNextJob();return null}}else{pixelTypeName=arguments[1];pixelParams=arguments[2];Object.keys(pixels).forEach(dsid=>{const pixelData=pixels[dsid];if(pixelData){pixelsToSend.push({dsid,...pixelData})}})}if(pixelTypeName===DELAYED_PAGE_VIEW&&!timeoutHandler){console.log('Skipping delayed page view');pullNextJob();return null}if(!pixelsToSend.length){console.error('Requested sending pixel '+pixelTypeName+' with no pixels initiated');pullNextJob();return null}if(pixelParams&&Object.prototype.toString.call(pixelParams)==='[object Object]'){paramsObjStr=encodeURIComponent(JSON.stringify(pixelParams))}if(['track','trackSingle','trackSingleCustom'].includes(operation)){type=clinchPixelTypeDic[pixelTypeName];if(!pixelTypeName||!type){return null}if('pageView'===type&&pixelTypeName!==DELAYED_PAGE_VIEW){const utm_source=getQuerystringParams()['utm_source'];if(!paramsObjStr&&!utm_source){return null}}if(["purchase","registration"].includes(type)){stype=type;type="conv"}}else if(operation==="trackCustom"&&pixelTypeName){type="Other";stype=pixelTypeName}else{pullNextJob();return null}if(pixelParams!=null){if(pixelParams.subType){stype=pixelParams.subType}if(pixelParams.content_ids!=null&&pixelParams.content_ids.length>0){content_ids=pixelParams.content_ids}else if(pixelParams.contents!=null&&pixelParams.contents.length>0){for(let productInd=0;productInd<pixelParams.contents.length;++productInd){if(pixelParams.contents[productInd]!=null&&pixelParams.contents[productInd].id!=null){content_ids.push(pixelParams.contents[productInd].id)}}}if(content_ids.length>0){if(Array.isArray(content_ids)){clinchPixelIds=content_ids.join(',')}else{clinchPixelIds=content_ids}}clinchCustomParams+="&ids="+clinchPixelIds;for(let fbParam in fbToClinchParameterDic){if(pixelParams[fbParam]!=null){clinchCustomParams+="&"+fbToClinchParameterDic[fbParam]+"="+pixelParams[fbParam]}}}firePixels(pixelsToSend,type,stype,clinchCustomParams,paramsObjStr)}catch(err){console.log(err);pullNextJob()}};function firePixels(a,b,c,d,e){const pixel=a.shift();const pixelElement=generatePixelElement(pixel,b,c,d,e);if(a.length){pixelElement.onload=pixelElement.onerror=function(){firePixels(a,b,c,d,e)}}else{pixelElement.onload=pixelElement.onerror=pullNextJob}document.getElementsByTagName('body')[0].appendChild(pixelElement)};function pullNextJob(){setTimeout(function(){h=executeJobQueue.shift();if(h){executeJob.apply(this,h)}},50)};function generatePixelElement(a,b,c,d,e){let pixelUrl="//"+TRK_SERVER+"/trk?"+"cid="+a.cid+(a.dsid?("&dsid="+a.dsid):'')+"&type="+b+(c?("&stype="+c):"")+(d?d:'')+(e?("&params="+e):'')+"&product="+a.product+"&referrer="+encodeURIComponent(window.location.href)+"&version="+ver+"&a="+Date.now();if(a.clinchClickId){pixelUrl+="&clinchClickId_"+a.cid+'='+a.clinchClickId}let pixelElement;if(a.pixelType===pixelTypes.img){pixelElement=new Image()}else{pixelElement=document.createElement('iframe')}pixelElement.style.display='none';pixelElement.src=pixelUrl;return pixelElement};function parsePixelInitializationArgs(b){let dsid='';let options={product:'ecommerce',pixelType:pixelTypes.iframe,cid:'',use1PCookie:true,clinchClickId:''};if(typeof b[2]==="object"){dsid=b[1];const recievedOptions=b[2];Object.assign(options,recievedOptions)}else{dsid=b[2];if(dsid.length===2){dsid=b[1]}options.cid=b[1];if(b[3]){options.product=b[3]}}const clickIdParam=getQuerystringParams()[CLINCH_CLICK_ID_PARAM_NAME+'_'+options.cid];if(clickIdParam){options.clinchClickId=clickIdParam;cookieManager.setCookie('clickId_'+options.cid,clickIdParam);return Promise.resolve({dsid,options})}else{return cookieManager.getCookie('clickId_'+options.cid).then(function(a){options.clinchClickId=a;return{dsid,options}})}};function executeJob(a){let pixelTypeName=arguments[1];if(a==='trackSingle'){pixelTypeName=arguments[2]}if(pixelTypeName!=='PageView'&&timeoutHandler){clearTimeout(timeoutHandler);timeoutHandler=null}clqOperation.apply(this,arguments)};window.clq.callMethod=function(){if(arguments[0]===INIT_PIXEL_EVENT_NAME){parsePixelInitializationArgs(arguments).then(function(a){initPixel(a.dsid,a.options);pullNextJob()})}else{if(Object.keys(pixels).length){executeJob.apply(this,arguments)}else{executeJobQueue.push(arguments)}}};while(h=window.clq.queue.shift()){window.clq.apply(window.clq,h)}}();